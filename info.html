<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>나는 로봇이 아닙니다 – CAPTCHA</title>
  <!-- NOTE: 본 예시는 반응형(데스크탑·노트북·태블릿·모바일 자동 대응)입니다. 화면에는 표시하지 않습니다. -->
  <!-- NOTE: 흐름은 (Checkbox → 캡차)입니다. 화면에는 표시하지 않습니다. -->
  <style>
    :root{
      --bg:#f7f9fc; --card:#ffffff; --ink:#0f172a; --text:#111827; --muted:#5b6477; --accent:#2563eb;
      --good:#16a34a; --warn:#d97706; --bad:#dc2626; --border:#e5e7eb;
    }
    @media (prefers-color-scheme: dark){
      :root{ --bg:#0e1116; --card:#161a22; --ink:#f3f4f6; --text:#e6ebf2; --muted:#9aa3b2; --accent:#60a5fa; --border:#253043; }
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; background:var(--bg); color:var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial, sans-serif;}

    .wrap{min-height:100svh; display:grid; place-items:center; padding:clamp(16px,3vw,40px)}
    .card{width:min(760px,94vw); background:var(--card); border:1px solid var(--border); border-radius:18px; padding:clamp(18px,2.4vw,28px); box-shadow:0 14px 40px rgba(0,0,0,.08)}

    .title{display:flex; align-items:center; gap:12px; margin-bottom:12px}
    .title h1{font-size:clamp(18px,2.4vw,22px); margin:0; font-weight:800; letter-spacing:.2px}
    .sub{margin:0; color:var(--muted); font-size:clamp(12px,1.6vw,14px)}

    .box{border:1px solid var(--border); border-radius:14px; padding:clamp(14px,2vw,18px); background:linear-gradient(180deg,#fff,rgba(255,255,255,.9));}
    @media (prefers-color-scheme: dark){ .box{ background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02)); } }

    .checkline{display:flex; align-items:center; gap:14px}
    .check{--size:clamp(24px,3.6vw,30px); width:var(--size); height:var(--size); aspect-ratio: 1; border-radius:0; border:2px solid var(--border); display:grid; place-items:center; background:#fff; cursor:pointer}
    .check input{appearance:none; width:100%; height:100%; margin:0; cursor:pointer}
    .check svg{width:70%; height:70%; opacity:0; transform:scale(.85); transition:.2s ease; color:var(--good)}
    .check.checked{border-color:var(--good); background:rgba(22,163,74,.12)}
    .check.checked svg{opacity:1; transform:scale(1)}

    .captcha{margin-top:14px; display:none}
    .captcha.open{display:grid; gap:12px}
    .capCanvasWrap{display:flex; align-items:center; gap:10px}
    canvas{border:1px dashed var(--border); border-radius:12px; background:repeating-linear-gradient(45deg, rgba(0,0,0,.10) 0 16px, transparent 16px 28px), #fff; width:100%; height:120px}
    @media (max-width:520px){ canvas{height:140px} }
    .capBtns{display:flex; gap:8px; flex-wrap:wrap}
    .capInput{display:flex; gap:10px; align-items:center}
    .capInput input{flex:1; min-width:140px; padding:12px; border-radius:12px; border:1px solid var(--border); background:#fff; color:var(--ink); font-size:16px}
    .btn{cursor:pointer; border:1px solid var(--border); background:#fff; color:var(--ink); padding:10px 14px; border-radius:12px; font-weight:600; font-size:14px; transition:.15s ease}
    .btn:hover{transform:translateY(-1px); box-shadow:0 6px 16px rgba(0,0,0,.08)}
    .btn.primary{background:linear-gradient(180deg,#eef4ff,#dfeaff)}

    .status{display:flex; align-items:center; gap:10px; color:var(--muted); font-size:13px; margin-top:4px}
    .status.error{ color: var(--bad); }
    /* 모바일 전용 조정 */
@media (max-width: 768px) {
  .captcha.open {
    max-width: 90%;   /* 전체 화면 대비 90% 폭 */
    margin: 0 auto;   /* 중앙 정렬 */
  }

  .capCanvasWrap {
    flex-direction: column; /* 캔버스와 버튼이 세로로 배치되게 */
    align-items: center;
  }

  canvas {
    width: 100%;        /* 화면 폭에 맞춤 */
    max-width: 300px;   /* 최대 크기를 제한 */
    height: auto;       /* 세로는 비율에 맞춰 자동 */
  }

  .capInput input {
    font-size: 14px;    /* 모바일 가독성 위해 약간 줄임 */
  }
}
@media (max-width: 768px) {
  .capInput input {
    color: #000 !important;   /* 항상 검은색 */
    background: #fff;         /* 흰 배경 유지 */
    -webkit-text-fill-color: #000; /* iOS 사파리 호환 */
  }
}
/* 모바일 전용 버튼 글씨 색 변경 */
@media (max-width: 768px) {
  .capBtns .btn,
  .capInput .btn {
    color: #000 !important;   /* 글씨를 항상 검정색 */
  }
}

  </style>
</head>
<body>
  <main class="wrap">
    <section class="card" aria-label="사람 인증 영역">
      <div class="title">
        
      </div>

      <div class="box">
        <div class="checkline">
          <label class="check" id="checkBox">
            <input id="chk" type="checkbox" aria-label="나는 로봇이 아닙니다" />
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M20 6 9 17l-5-5"/></svg>
          </label>
          <div>
            <strong>나는 로봇이 아닙니다</strong>
            <p class="sub">체크하면 사람이 읽을 수 있는 문자 이미지가 표시됩니다. <b>정확히 입력(대/소문자 구분)</b>하면 이동합니다.</p>
          </div>
        </div>

        <div class="captcha" id="captcha">
          <div class="capCanvasWrap">
            <canvas id="capCanvas" width="500" height="160" aria-label="사람 판독 캡차"></canvas>
            <div class="capBtns">
              <button class="btn" id="btnRefresh" type="button" aria-label="새 이미지">새로고침</button>
            </div>
          </div>
          <div class="capInput">
            <input id="capInput" placeholder="보이는 글자를 정확히 입력 (대/소문자 구분)" aria-label="캡차 정답 입력" inputmode="text" autocomplete="off" />
            <button class="btn primary" id="btnVerify" type="button">확인</button>
          </div>
          <div class="status" id="statusText">미인증 상태입니다.</div>
        </div>
      </div>

    </section>
  </main>

  <script>
  (function(){
    'use strict';

    /*** State ***/
    var state = { code: '', verified: false, tries: 0 };

    /*** Elements ***/
    var chk = document.getElementById('chk');
    var checkBox = document.getElementById('checkBox');
    var captcha = document.getElementById('captcha');
    var canvas = document.getElementById('capCanvas');
    var ctx = canvas.getContext('2d');
    var input = document.getElementById('capInput');
    var btnRefresh = document.getElementById('btnRefresh');
    var btnVerify = document.getElementById('btnVerify');
    var statusText = document.getElementById('statusText');

    /*** Utils ***/
    function rand(min, max){ return Math.floor(Math.random() * (max - min + 1)) + min; }
    function pick(arr){ return arr[Math.floor(Math.random() * arr.length)]; }

    /*** Code generation (A–Z, a–z, 2–9; no ambiguous) ***/
    function genCode(){
      var chars = 'ABCDEFGHJKLMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789';
      var s = '';
      for (var i = 0; i < 6; i++) s += chars[Math.floor(Math.random() * chars.length)];
      return s;
    }

    /*** Draw CAPTCHA on Canvas ***/
    function drawCaptcha(){
      var dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      var w = 500, h = 160;
      canvas.width = w * dpr; canvas.height = h * dpr; canvas.style.width = w + 'px'; canvas.style.height = h + 'px';
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);

      // background gradient
      var grad = ctx.createLinearGradient(0, 0, w, h);
      grad.addColorStop(0, '#f8fbff'); grad.addColorStop(1, '#eef2ff');
      ctx.fillStyle = grad; ctx.fillRect(0, 0, w, h);

      // thick dark noise lines
      for (var i = 0; i < 14; i++){
        ctx.lineWidth = rand(3, 6);
        ctx.strokeStyle = 'rgba(0,0,0,0.35)';
        ctx.beginPath();
        ctx.moveTo(rand(0, w/4), rand(0, h));
        for (var x = 0; x < w; x += rand(40, 90)) { ctx.lineTo(x + rand(-20, 20), rand(0, h)); }
        ctx.stroke();
      }

      // distorted text
      var code = state.code;
      var xPos = 40;
      for (var j = 0; j < code.length; j++){
        var ch = code[j];
        var size = rand(34, 46);
        var angle = rand(-25, 25) * Math.PI / 180;
        var y = rand(h / 2, h - 40);
        ctx.save();
        ctx.translate(xPos, y);
        ctx.rotate(angle);
        ctx.font = '700 ' + size + 'px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto';
        ctx.fillStyle = pick(['#1f2937', '#111827', '#334155']);
        ctx.shadowColor = 'rgba(0,0,0,.12)';
        ctx.shadowBlur = 2;
        ctx.fillText(ch, 0, 0);
        ctx.restore();
        xPos += size + rand(6, 18);
      }

      // dot noise
      for (var k = 0; k < 300; k++){
        ctx.fillStyle = 'rgba(0,0,0,0.18)';
        ctx.fillRect(rand(0, w), rand(0, h), 1, 1);
      }
    }

    function newCaptcha(){
      state.code = genCode();
      drawCaptcha();
    }

    function openCaptcha(){
      captcha.classList.add('open');
      input.value = '';
      statusText.textContent = '미인증 상태입니다.';
      statusText.classList.remove('error');
      newCaptcha();
      setTimeout(function(){ try { input.focus({ preventScroll: true }); } catch(e) { input.focus(); } }, 0);
    }

    function setVerified(ok){
      state.verified = ok;
      chk.checked = ok; chk.disabled = ok;
      checkBox.classList.toggle('checked', ok);
      statusText.classList.remove('error');
      statusText.textContent = ok ? '인증 완료 – 이동합니다…' : '미인증 상태입니다.';
      if (ok) { setTimeout(function(){ window.location.href = 'cctv.html'; }, 300); }
    }

    function handleVerify(){
      var v = (input.value || '');
      if (v && v === state.code){
        state.tries = 0;
        setVerified(true);
      } else {
        state.tries += 1;
        statusText.textContent = state.tries + '회 틀렸습니다. 다시 시도해주세요.';
        statusText.classList.add('error');
        input.value = '';
        if (state.tries >= 3) { window.location.href = 'login.html'; return; }
        newCaptcha();
      }
    }

    /*** Events ***/
    chk.addEventListener('click', function(e){
      if (!state.verified){ e.preventDefault(); openCaptcha(); }
    });

    btnRefresh.addEventListener('click', newCaptcha);
    btnVerify.addEventListener('click', handleVerify);
    input.addEventListener('keydown', function(e){
      if ((e.key === 'Enter' || e.key === 'NumpadEnter') && !e.isComposing && !e.repeat){
        e.preventDefault();
        handleVerify();
      }
    });

    window.addEventListener('resize', function(){ if (captcha.classList.contains('open')) { drawCaptcha(); } });
  })();
  </script>
</body>
</html>