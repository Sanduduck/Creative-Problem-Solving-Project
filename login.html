<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Log In</title>

  <!--Bootstrap Css-->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
  <!--Font-aweome-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">

  <style>
    :root{
      --background-theme:#fdfdfd;
      --panel-bg:#fdfdfd;
      --text-color:#000;
      --muted:#000;
      --accent:#000;
      --border:#555;
    }

    *,html{
      margin:0;
      padding:0;
      font-size:10px;
      color:var(--text-color);
      box-sizing:border-box;
      font-family:'Poppins',sans-serif;
    }

    body{ width:100%; background-color:var(--background-theme); }
    h1{ font-size:3.2rem; }
    p{ font-size:1.2rem; }

    /* Sections */
    .login_section{
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      padding:16px;
    }

    .accounts_container{
      height:550px;
      min-height:550px;
      max-height:100%;
      border-radius:10px;
      box-shadow:8px 8px 8px rgba(0,0,0,0.25);
      background-color:var(--panel-bg);
      overflow:hidden;
      width:100%;
      max-width:1100px;
    }

    /* 좌측 이미지 영역 */
    .accounts_image img{
      object-fit:cover;
      object-position:center;
      border-top-left-radius:10px;
      border-bottom-left-radius:10px;
      filter:brightness(1);
    }

    .accounts_col form .form-group{ position:relative !important; }
    .accounts_col form .form-control{
      font-size:1.6rem;
      padding:20px 12px 14px 12px;
      margin-bottom:24px;
      background:transparent !important;
      color:#000;
      border:1px solid var(--border);
      border-radius:8px;
    }
    .accounts_col form .form-control::placeholder{ color:#aaa; }

    .accounts_col form label,
    .accounts_col form .form-group i{
      position:absolute;
      z-index:1;
      pointer-events:none;
      top:50%;
      transform:translateY(-50%);
      font-size:1.2rem;
      left:14px;
      color:var(--muted);
      transition:.2s linear;
    }

    .change_label{
      background-color:var(--panel-bg);
      padding:0 6px;
      transform:scale(0.9);
      top:-8px !important;
      color:#000;
    }

    .accounts_col form .form-group i{
      left:auto !important;
      right:12px;
      cursor:pointer;
      pointer-events:visible;
      color:#000;
    }

    .register_btn{
      padding:10px 0 !important;
      font-size:1.6rem !important;
      font-weight:600 !important;
      background:var(--accent);
      border:none;
    }

    .already_member_box p,
    .already_member_box span{
      cursor:pointer;
      color:#000;
    }
    .login_form, .signup_form{ display:none; }

    .title h1{ color:#000; }
    .title p{ color:#000; }

    /* 에러/성공 메시지 */
    .msg-error{color:#c62828;font-size:1.3rem;margin-top:-6px;margin-bottom:12px;display:none;}
    .msg-ok{color:#1b5e20;font-size:1.3rem;margin-top:-6px;margin-bottom:12px;display:none;}

    /* 반응형 (기본) */
    @media (max-width:992px){
      .accounts_image{ display:none; }     /* 모바일에서 좌측 큰 이미지 숨김 */
      .accounts_container{ max-width:560px; }
    }

    /* ===== 모바일 전용 배너 (#signup 내부) + 모드 토글 ===== */
    .mobile-hero{ display:none; }

    @media (max-width: 992px){
      /* 기본(로그인 모드): 고정 높이 유지 */
      .accounts_container{
        height:550px;
        min-height:550px;
        overflow:hidden;
      }

      /* 회원가입 모드에서만: 배너 표시 + 높이 자동 확장 */
      body.mode-signup .accounts_container{
        height:auto;
        min-height:0;
        overflow:visible;
      }
      body.mode-signup #signup .mobile-hero{
        display:block !important;
        width:100%;
        margin:0;
      }
      body.mode-signup #signup .mobile-hero img{
        display:block;
        width:100%;
        height:auto;
        aspect-ratio: 1 / 2;   /* 2:4 비율(=세로형) */
        object-fit:cover;       /* 칸에 꽉 채움 */
        object-position:50% 40%;
        border-radius:10px 10px 0 0;
      }

      /* 배너 추가에 따른 제목 상단 여백 보정 */
      .accounts_forms .title{ padding-top:16px; }
    }

    /* 데스크탑/노트북 복구(명시적) */
    @media (min-width: 993px){
      .accounts_image{ display:block !important; }
      .mobile-hero{ display:none !important; }
      .accounts_container{
        height:550px !important;
        min-height:550px !important;
        max-height:100% !important;
        overflow:hidden !important;
      }
    }
    @media (max-width: 992px){
  /* 0) 두 컬럼이 위아래로 쌓일 때, 각 컬럼 높이를 자동으로 */
  .accounts_col{ height: auto !important; }

  /* 1) 좌측 이미지 다시 보이게 (기존 hide 덮어쓰기) */
  .accounts_image{ 
    display: block !important; 
    height: 220px;              /* 모바일에선 배너 높이로 */
    overflow: hidden; 
  }
  .accounts_image img{
    width: 100%;
    height: 100% !important;    /* Bootstrap .h-100 덮어쓰기 */
    object-fit: cover;          /* 칸에 꽉 채우며 크롭 */
    object-position: 50% 40%;
    border-radius: 10px 10px 0 0;
  }

  /* 2) 컨테이너도 자동 높이 (이미지+폼이 다 보이게) */
  .accounts_container{
    height: auto !important;
    min-height: 0 !important;
    max-height: none !important;
    overflow: visible !important;
  }

  /* 3) signup 내부에 넣어둔 모바일 전용 배너는 중복 방지를 위해 숨김 */
  .mobile-hero{ display: none !important; }
}
  </style>
</head>
<body>
  <section class="login_section">
    <div class="container outer_container accounts_container">
      <div class="row h-100">
        <!-- 좌측 이미지 -->
        <div class="col col-sm-12 col-md-12 col-lg-8 m-0 p-0 w-100 h-100 accounts_col">
          <div class="accounts_image w-100 h-100">
            <img src="https://img.freepik.com/free-photo/social-media-instagram-digital-marketing-concept-3d-rendering_106244-1717.jpg?w=1480"
                 alt="accounts_image" class="img-fluid w-100 h-100" />
          </div>
        </div>

        <!-- 우측 폼 -->
        <div class="col col-sm-12 col-md-12 col-lg-4 m-0 p-0 accounts_col">

          <!-- Sign Up (초기 비표시: .signup_form) -->
          <div class="accounts_forms signup_form w-100 h-100" id="signup">

            <!-- ✅ 모바일 전용 배너: 회원가입 화면에서만 보임 -->
            <div class="mobile-hero" aria-hidden="true">
              <img src="./images/login.png" alt="" width="800" height="1600">
            </div>

            <div class="title mt-4 p-4 w-100">
              <h1>Sign Up</h1>
              <p class="mt-3">Create your account to get started.</p>
            </div>

            <form method="post" class="form w-100 p-4" id="signup_form" novalidate>
              <div class="row">
                <div class="col-6 m-0">
                  <div class="form-group">
                    <label for="fname">Firstname</label>
                    <input type="text" name="fname" class="form-control" id="fname"
                           onfocus="labelUp(this)" onblur="labelDown(this)" required />
                  </div>
                </div>
                <div class="col-6 m-0">
                  <div class="form-group">
                    <label for="lname">Lastname</label>
                    <input type="text" name="lname" class="form-control" id="lname"
                           onfocus="labelUp(this)" onblur="labelDown(this)" required />
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label for="email_signup">Email</label>
                <input type="text" name="email" class="form-control" id="email_signup"
                       onfocus="labelUp(this)" onblur="labelDown(this)" required />
              </div>
              <div class="form-group">
                <label for="signup_password">Password</label>
                <i class="fa fa-eye-slash" id="eye_icon_signup"></i>
                <input type="password" name="pass" class="form-control" id="signup_password"
                       onfocus="labelUp(this)" onblur="labelDown(this)" required />
              </div>
              <div class="form-group">
                <label for="cpass">Confirm Password</label>
                <input type="password" name="cpass" class="form-control" id="cpass"
                       onfocus="labelUp(this)" onblur="labelDown(this)" required />
              </div>

              <!-- Sign Up 메시지 -->
              <div id="signup-msg" class="msg-error"></div>

              <div class="form-group">
                <button type="submit" class="btn btn-primary register_btn w-100">Sign Up</button>
              </div>
            </form>

            <div class="already_member_box">
              <p class="text-center" id="to_login">I am already member</p>
            </div>
          </div>

          <!-- Sign In (초기 표시) -->
          <div class="accounts_forms w-100 h-100" id="login">
            <div class="title mt-4 p-4 w-100">
              <h1>Sign In</h1>
              <p class="mt-3">Welcome back.</p>
            </div>

            <form method="post" class="form w-100 p-4" id="login_form" novalidate>
              <div class="form-group">
                <label for="email">Email</label>
                <input type="text" name="email" class="form-control" id="email"
                       onfocus="labelUp(this)" onblur="labelDown(this)" required />
              </div>
              <div class="form-group">
                <label for="login_password">Password</label>
                <i class="fa fa-eye-slash" id="eye_icon_login"></i>
                <input type="password" name="pass" class="form-control" id="login_password"
                       onfocus="labelUp(this)" onblur="labelDown(this)" required />
              </div>

              <!-- 로그인 에러 메시지 -->
              <div id="login-error" class="msg-error"></div>

              <div class="form-group mb-0">
                <button type="submit" class="btn btn-primary register_btn w-100">Sign In</button>
              </div>
            </form>

            <div class="already_member_box d-flex justify-content-between px-4">
              <span class="text-center" id="to_signup">Create an account?</span>
              <span class="text-center">Forgot password</span>
            </div>
          </div>

        </div>
        <!-- /우측 폼 -->
      </div>
    </div>
  </section>

  <!-- jQuery / Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    /* ========= 유틸: hex 변환 ========= */
    function toHex(u8){
      return Array.from(u8).map(b => b.toString(16).padStart(2,'0')).join('');
    }
    function fromHex(hex){
      if(!hex || hex.length % 2) return new Uint8Array();
      const out = new Uint8Array(hex.length/2);
      for(let i=0;i<out.length;i++){ out[i] = parseInt(hex.substr(i*2,2),16); }
      return out;
    }
    function genSaltHex(len=16){
      const b = new Uint8Array(len);
      (crypto.getRandomValues ? crypto.getRandomValues(b) : b.fill(0));
      return toHex(b);
    }
    function constantTimeEqual(a,b){
      if(a.length !== b.length) return false;
      let diff = 0;
      for(let i=0;i<a.length;i++){ diff |= a.charCodeAt(i) ^ b.charCodeAt(i); }
      return diff === 0;
    }
  
    /* ========= PBKDF2-SHA256 (Web Crypto) ========= */
    async function pbkdf2Hex(password, saltHex, iterations=310000, dkLen=32){
      if(!crypto?.subtle) throw new Error('WEBCRYPTO_UNAVAILABLE');
      const enc = new TextEncoder();
      const baseKey = await crypto.subtle.importKey(
        'raw', enc.encode(password), 'PBKDF2', false, ['deriveBits']
      );
      const bits = await crypto.subtle.deriveBits(
        { name:'PBKDF2', hash:'SHA-256', salt: fromHex(saltHex), iterations },
        baseKey,
        dkLen * 8
      );
      return toHex(new Uint8Array(bits));
    }
  
    /* ========= (레거시 호환) SHA-256 단순 해시 ========= */
    async function sha256(text){
      if(crypto?.subtle){
        const enc = new TextEncoder().encode(text);
        const buf = await crypto.subtle.digest('SHA-256', enc);
        return toHex(new Uint8Array(buf));
      }
      return 'plain:' + text; // 구형 브라우저 매우 취약 (데모용)
    }
  
    /* ========= localStorage 래퍼 ========= */
    const LS_USERS = 'ae_users_v1';
    function loadUsers(){
      try{ const raw = localStorage.getItem(LS_USERS); return raw ? JSON.parse(raw) : {}; }
      catch(e){ console.warn('[users] load fail', e); return {}; }
    }
    function saveUsers(users){
      try{ localStorage.setItem(LS_USERS, JSON.stringify(users)); }
      catch(e){ console.warn('[users] save fail', e); }
    }
  
    function normalizeId(id){ return (id||'').trim(); }
  
    /* ========= 라벨 애니메이션 ========= */
    function labelUp(input){ input.parentElement.children[0].classList.add("change_label"); }
    function labelDown(input){ if(!input.value.trim()){ input.parentElement.children[0].classList.remove("change_label"); } }
  
    /* ========= 패스워드 보기/숨기기 ========= */
    const eye_icon_signup = document.getElementById('eye_icon_signup');
    const eye_icon_login  = document.getElementById('eye_icon_login');
    const sign_up_password = document.getElementById('signup_password');
    const login_password   = document.getElementById('login_password');
    if(eye_icon_signup){ eye_icon_signup.addEventListener('click', ()=> toggleEye(eye_icon_signup, sign_up_password)); }
    if(eye_icon_login){  eye_icon_login .addEventListener('click', ()=> toggleEye(eye_icon_login , login_password )); }
    function toggleEye(eye_icon, password){
      if(!eye_icon || !password) return;
      if(eye_icon.classList.contains("fa-eye-slash")){
        eye_icon.classList.remove('fa-eye-slash'); eye_icon.classList.add('fa-eye'); password.type='text';
      }else{
        eye_icon.classList.remove('fa-eye'); eye_icon.classList.add('fa-eye-slash'); password.type='password';
      }
    }
  
    /* ========= 폼 전환 + 모드 클래스 ========= */
    const to_signup = document.getElementById('to_signup');
    const to_login  = document.getElementById('to_login');
  
    function updateModeClass(){
      const signupHidden = document.getElementById('signup').classList.contains('signup_form');
      document.body.classList.toggle('mode-signup', !signupHidden);
      if (!signupHidden) {
        const hero = document.querySelector('#signup .mobile-hero img');
        if (hero) { hero.loading = 'eager'; hero.src = hero.src; }
      }
    }
    function let_change(){
      const login  = document.getElementById('login');
      const signup = document.getElementById('signup');
      login.classList.toggle('login_form');
      signup.classList.toggle('signup_form');
      const e1=document.getElementById('login-error'); if(e1) e1.style.display='none';
      const e2=document.getElementById('signup-msg');  if(e2) e2.style.display='none';
      updateModeClass();
    }
    if(to_signup) to_signup.addEventListener('click', let_change);
    if(to_login)  to_login .addEventListener('click', let_change);
    document.addEventListener('DOMContentLoaded', updateModeClass);
  
    /* ========= Sign Up (PBKDF2-SHA256 저장) ========= */
    (function(){
      const form = document.getElementById('signup_form');
      if(!form) return;
  
      form.addEventListener('submit', async function(e){
        e.preventDefault();
        const fname = normalizeId(document.getElementById('fname').value);
        const lname = normalizeId(document.getElementById('lname').value);
        const email = normalizeId(document.getElementById('email_signup').value);
        const pass  = document.getElementById('signup_password').value || '';
        const cpass = document.getElementById('cpass').value || '';
        const msg   = document.getElementById('signup-msg');
  
        if(!email || !pass || !cpass){
          msg.textContent = '모든 필드를 입력해주세요.'; msg.style.display='block'; return;
        }
        if(pass.length < 4){
          msg.textContent = '비밀번호는 4자 이상으로 설정해주세요.'; msg.style.display='block'; return;
        }
        if(pass !== cpass){
          msg.textContent = '비밀번호가 일치하지 않습니다.'; msg.style.display='block'; return;
        }
  
        const users = loadUsers();
        if(users[email]){
          msg.textContent = '이미 존재하는 아이디입니다.'; msg.style.display='block'; return;
        }
  
        try{
          const saltHex = genSaltHex(16);                   // 128-bit salt
          const hashHex = await pbkdf2Hex(pass, saltHex);   // 32바이트(256bit) 도출
          users[email] = {
            email, fname, lname, role:'viewer', createdAt: Date.now(),
            passInfo: { alg:'PBKDF2-SHA256', iter:310000, salt:saltHex, hash:hashHex }
          };
          saveUsers(users);
  
          localStorage.setItem('ae_role','viewer');
          localStorage.setItem('ae_user', email);
  
          msg.classList.remove('msg-error');
          msg.classList.add('msg-ok');
          msg.textContent = '계정이 생성되었습니다. 로그인 화면으로 이동하세요.';
          msg.style.display='block';
          setTimeout(()=>{
            let_change(); // signup ↔ login 폼을 바꾸는 함수 (이미 코드에 있음)
          }, 1000);
        }catch(err){
          console.error(err);
          msg.textContent = '이 브라우저는 보안 기능(WebCrypto)을 지원하지 않습니다.'; msg.style.display='block';
        }
      });
    })();
  
    /* ========= Sign In (PBKDF2-SHA256 검증 + 레거시 마이그레이션) ========= */
    (function(){
      const loginForm = document.getElementById('login_form');
      if(!loginForm) return;
  
      loginForm.addEventListener('submit', async function(e){
        e.preventDefault();
        const id = normalizeId(document.getElementById('email').value);
        const pw = document.getElementById('login_password').value || '';
        const err = document.getElementById('login-error');
  
        if(!id || !pw){
          err.textContent = '아이디와 비밀번호를 입력하세요.'; err.style.display='block'; return;
        }
  
        // 관리자 특례
        if(id === 'admin' && pw === 'admin'){
          localStorage.setItem('ae_role','admin');
          localStorage.setItem('ae_user', id);
          err.style.display = 'none';
          window.location.href = 'info.html';
          return;
        }
  
        const users = loadUsers();
        const u = users[id];
        if(!u){ err.textContent = '존재하지 않는 아이디입니다.'; err.style.display='block'; return; }
  
        try{
          if (u.passInfo && u.passInfo.alg === 'PBKDF2-SHA256'){
            const want = await pbkdf2Hex(pw, u.passInfo.salt, u.passInfo.iter || 310000, 32);
            if(!constantTimeEqual(want, u.passInfo.hash)){
              err.textContent = '비밀번호가 올바르지 않습니다.'; err.style.display='block'; return;
            }
          } else {
            // 레거시(sha256 또는 plain:) 지원 → 성공 시 즉시 PBKDF2로 업그레이드
            const legacy = await sha256(pw);
            if (legacy !== u.passwordHash){
              err.textContent = '비밀번호가 올바르지 않습니다.'; err.style.display='block'; return;
            }
            const saltHex = genSaltHex(16);
            const hashHex = await pbkdf2Hex(pw, saltHex, 310000, 32);
            u.passInfo = { alg:'PBKDF2-SHA256', iter:310000, salt:saltHex, hash:hashHex };
            delete u.passwordHash;
            saveUsers(users);
          }
  
          localStorage.setItem('ae_role', u.role || 'viewer');
          localStorage.setItem('ae_user', u.email);
          err.style.display = 'none';
          window.location.href = 'info.html';
        }catch(err2){
          console.error(err2);
          err.textContent = '이 브라우저는 보안 기능(WebCrypto)을 지원하지 않습니다.'; err.style.display='block';
        }
      });
    })();
    const mongoose = require('mongoose');

// Atlas 클러스터 URI
const uri = 'mongodb+srv://admin1234:YOUR_PASSWORD@cluster0.zab9dwo.mongodb.net/mydb?retryWrites=true&w=majority';

// DB 연결
mongoose.connect(uri, { useNewUrlParser: true, useUnifiedTopology: true })
      .then(() => console.log('MongoDB 연결 성공!'))
      .catch(err => console.error('MongoDB 연결 실패:', err));

// 간단한 스키마와 모델 생성
const testSchema = new mongoose.Schema({
    name: String,
    age: Number
});

const Test = mongoose.model('Test', testSchema);

// 문서 추가
async function addDocument() {
    const doc = new Test({ name: 'Alice', age: 25 });
    await doc.save();
    console.log('문서 추가 완료:', doc);
}

// 문서 조회
async function getDocuments() {
    const docs = await Test.find();
    console.log('현재 DB 문서:', docs);
}

// 실행
mongoose.connection.once('open', async () => {
    await addDocument();
    await getDocuments();
    mongoose.connection.close();
});
  </script>
  
</body>
</html>
