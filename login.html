<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Log In</title>

  <!--Bootstrap Css-->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
  <!--Font-aweome-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">

  <style>
    :root{
      --background-theme:#fdfdfd;
      --panel-bg:#fdfdfd;
      --text-color:#000;
      --muted:#000;
      --accent:#000;
      --border:#555;
    }

    *,html{
      margin:0;
      padding:0;
      font-size:10px;
      color:var(--text-color);
      box-sizing:border-box;
      font-family:'Poppins',sans-serif;
    }

    body{ width:100%; background-color:var(--background-theme); }
    h1{ font-size:3.2rem; }
    p{ font-size:1.2rem; }

    /* Sections */
    .login_section{
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      padding:16px;
    }

    .accounts_container{
      height:550px;
      min-height:550px;
      max-height:100%;
      border-radius:10px;
      box-shadow:8px 8px 8px rgba(0,0,0,0.25);
      background-color:var(--panel-bg);
      overflow:hidden;
      width:100%;
      max-width:1100px;
    }

    /* 좌측 이미지 영역 */
    .accounts_image img{
      object-fit:cover;
      object-position:center;
      border-top-left-radius:10px;
      border-bottom-left-radius:10px;
      filter:brightness(1);
    }

    .accounts_col form .form-group{ position:relative !important; }
    .accounts_col form .form-control{
      font-size:1.6rem;
      padding:20px 12px 14px 12px;
      margin-bottom:24px;
      background:transparent !important;
      color:#000;
      border:1px solid var(--border);
      border-radius:8px;
    }
    .accounts_col form .form-control::placeholder{ color:#aaa; }

    .accounts_col form label,
    .accounts_col form .form-group i{
      position:absolute;
      z-index:1;
      pointer-events:none;
      top:50%;
      transform:translateY(-50%);
      font-size:1.2rem;
      left:14px;
      color:var(--muted);
      transition:.2s linear;
    }

    .change_label{
      background-color:var(--panel-bg);
      padding:0 6px;
      transform:scale(0.9);
      top:-8px !important;
      color:#000;
    }

    .accounts_col form .form-group i{
      left:auto !important;
      right:12px;
      cursor:pointer;
      pointer-events:visible;
      color:#000;
    }

    .register_btn{
      padding:10px 0 !important;
      font-size:1.6rem !important;
      font-weight:600 !important;
      background:var(--accent);
      border:none;
    }

    .already_member_box p,
    .already_member_box span{
      cursor:pointer;
      color:#000;
    }
    .login_form, .signup_form{ display:none; }

    .title h1{ color:#000; }
    .title p{ color:#000; }

    /* 에러/성공 메시지 */
    .msg-error{color:#c62828;font-size:1.3rem;margin-top:-6px;margin-bottom:12px;display:none;}
    .msg-ok{color:#1b5e20;font-size:1.3rem;margin-top:-6px;margin-bottom:12px;display:none;}

    /* 반응형 (기본) */
    @media (max-width:992px){
      .accounts_image{ display:none; }     /* 모바일에서 좌측 큰 이미지 숨김 */
      .accounts_container{ max-width:560px; }
    }

    /* ===== 모바일 전용 배너 (#signup 내부) + 모드 토글 ===== */
    .mobile-hero{ display:none; }

    @media (max-width: 992px){
      /* 기본(로그인 모드): 고정 높이 유지 */
      .accounts_container{
        height:550px;
        min-height:550px;
        overflow:hidden;
      }

      /* 회원가입 모드에서만: 배너 표시 + 높이 자동 확장 */
      body.mode-signup .accounts_container{
        height:auto;
        min-height:0;
        overflow:visible;
      }
      body.mode-signup #signup .mobile-hero{
        display:block !important;
        width:100%;
        margin:0;
      }
      body.mode-signup #signup .mobile-hero img{
        display:block;
        width:100%;
        height:auto;
        aspect-ratio: 1 / 2;   /* 2:4 비율(=세로형) */
        object-fit:cover;       /* 칸에 꽉 채움 */
        object-position:50% 40%;
        border-radius:10px 10px 0 0;
      }

      /* 배너 추가에 따른 제목 상단 여백 보정 */
      .accounts_forms .title{ padding-top:16px; }
    }

    /* 데스크탑/노트북 복구(명시적) */
    @media (min-width: 993px){
      .accounts_image{ display:block !important; }
      .mobile-hero{ display:none !important; }
      .accounts_container{
        height:550px !important;
        min-height:550px !important;
        max-height:100% !important;
        overflow:hidden !important;
      }
    }
  </style>
</head>
<body>
  <section class="login_section">
    <div class="container outer_container accounts_container">
      <div class="row h-100">
        <!-- 좌측 이미지 -->
        <div class="col col-sm-12 col-md-12 col-lg-8 m-0 p-0 w-100 h-100 accounts_col">
          <div class="accounts_image w-100 h-100">
            <img src="https://img.freepik.com/free-photo/social-media-instagram-digital-marketing-concept-3d-rendering_106244-1717.jpg?w=1480"
                 alt="accounts_image" class="img-fluid w-100 h-100" />
          </div>
        </div>

        <!-- 우측 폼 -->
        <div class="col col-sm-12 col-md-12 col-lg-4 m-0 p-0 accounts_col">

          <!-- Sign Up (초기 비표시: .signup_form) -->
          <div class="accounts_forms signup_form w-100 h-100" id="signup">

            <!-- ✅ 모바일 전용 배너: 회원가입 화면에서만 보임 -->
            <div class="mobile-hero" aria-hidden="true">
              <img src="./images/login.png" alt="" width="800" height="1600">
            </div>

            <div class="title mt-4 p-4 w-100">
              <h1>Sign Up</h1>
              <p class="mt-3">Create your account to get started.</p>
            </div>

            <form method="post" class="form w-100 p-4" id="signup_form" novalidate>
              <div class="row">
                <div class="col-6 m-0">
                  <div class="form-group">
                    <label for="fname">Firstname</label>
                    <input type="text" name="fname" class="form-control" id="fname"
                           onfocus="labelUp(this)" onblur="labelDown(this)" required />
                  </div>
                </div>
                <div class="col-6 m-0">
                  <div class="form-group">
                    <label for="lname">Lastname</label>
                    <input type="text" name="lname" class="form-control" id="lname"
                           onfocus="labelUp(this)" onblur="labelDown(this)" required />
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label for="email_signup">Email</label>
                <input type="text" name="email" class="form-control" id="email_signup"
                       onfocus="labelUp(this)" onblur="labelDown(this)" required />
              </div>
              <div class="form-group">
                <label for="signup_password">Password</label>
                <i class="fa fa-eye-slash" id="eye_icon_signup"></i>
                <input type="password" name="pass" class="form-control" id="signup_password"
                       onfocus="labelUp(this)" onblur="labelDown(this)" required />
              </div>
              <div class="form-group">
                <label for="cpass">Confirm Password</label>
                <input type="password" name="cpass" class="form-control" id="cpass"
                       onfocus="labelUp(this)" onblur="labelDown(this)" required />
              </div>

              <!-- Sign Up 메시지 -->
              <div id="signup-msg" class="msg-error"></div>

              <div class="form-group">
                <button type="submit" class="btn btn-primary register_btn w-100">Sign Up</button>
              </div>
            </form>

            <div class="already_member_box">
              <p class="text-center" id="to_login">I am already member</p>
            </div>
          </div>

          <!-- Sign In (초기 표시) -->
          <div class="accounts_forms w-100 h-100" id="login">
            <div class="title mt-4 p-4 w-100">
              <h1>Sign In</h1>
              <p class="mt-3">Welcome back.</p>
            </div>

            <form method="post" class="form w-100 p-4" id="login_form" novalidate>
              <div class="form-group">
                <label for="email">Email</label>
                <input type="text" name="email" class="form-control" id="email"
                       onfocus="labelUp(this)" onblur="labelDown(this)" required />
              </div>
              <div class="form-group">
                <label for="login_password">Password</label>
                <i class="fa fa-eye-slash" id="eye_icon_login"></i>
                <input type="password" name="pass" class="form-control" id="login_password"
                       onfocus="labelUp(this)" onblur="labelDown(this)" required />
              </div>

              <!-- 로그인 에러 메시지 -->
              <div id="login-error" class="msg-error"></div>

              <div class="form-group mb-0">
                <button type="submit" class="btn btn-primary register_btn w-100">Sign In</button>
              </div>
            </form>

            <div class="already_member_box d-flex justify-content-between px-4">
              <span class="text-center" id="to_signup">Create an account?</span>
              <span class="text-center">Forgot password</span>
            </div>
          </div>

        </div>
        <!-- /우측 폼 -->
      </div>
    </div>
  </section>

  <!-- jQuery / Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    /* ========= 라벨 애니메이션 ========= */
    function labelUp(input){ input.parentElement.children[0].classList.add("change_label"); }
    function labelDown(input){ if(!input.value.trim()){ input.parentElement.children[0].classList.remove("change_label"); } }

    /* ========= 패스워드 보기/숨기기 ========= */
    const eye_icon_signup = document.getElementById('eye_icon_signup');
    const eye_icon_login  = document.getElementById('eye_icon_login');
    const sign_up_password = document.getElementById('signup_password');
    const login_password   = document.getElementById('login_password');
    if(eye_icon_signup){
      eye_icon_signup.addEventListener('click', ()=> hideAndShowPass(eye_icon_signup, sign_up_password));
    }
    if(eye_icon_login){
      eye_icon_login.addEventListener('click', ()=> hideAndShowPass(eye_icon_login, login_password));
    }
    function hideAndShowPass(eye_icon, password){
      if(!eye_icon || !password) return;
      if(eye_icon.classList.contains("fa-eye-slash")){
        eye_icon.classList.remove('fa-eye-slash'); eye_icon.classList.add('fa-eye'); password.type='text';
      }else{
        eye_icon.classList.remove('fa-eye'); eye_icon.classList.add('fa-eye-slash'); password.type='password';
      }
    }

    /* ========= 폼 전환 + 모드 클래스 토글 ========= */
    const to_signup = document.getElementById('to_signup');
    const to_login  = document.getElementById('to_login');

    function updateModeClass(){
      // #signup이 보이면(= .signup_form 클래스가 없으면) 회원가입 모드
      const signupHidden = document.getElementById('signup').classList.contains('signup_form');
      document.body.classList.toggle('mode-signup', !signupHidden);

      // 회원가입 화면일 때 이미지 로드 보장 (숨김 상태/lazy 이슈 대응)
      if (!signupHidden) {
        const hero = document.querySelector('#signup .mobile-hero img');
        if (hero) {
          hero.loading = 'eager';  // 지원 브라우저에서 즉시 로드
          hero.src = hero.src;     // 강제 리로드 트릭(사파리 등)
        }
      }
    }

    function let_change(){
      const login  = document.getElementById('login');
      const signup = document.getElementById('signup');
      login.classList.toggle('login_form');
      signup.classList.toggle('signup_form');
      // 메시지 초기화
      const e1=document.getElementById('login-error'); if(e1) e1.style.display='none';
      const e2=document.getElementById('signup-msg');  if(e2) e2.style.display='none';
      // 모드 클래스 갱신
      updateModeClass();
    }

    if(to_signup) to_signup.addEventListener('click', let_change);
    if(to_login)  to_login.addEventListener('click', let_change);

    // 초기 모드 설정(처음엔 로그인 화면)
    document.addEventListener('DOMContentLoaded', updateModeClass);

    /* ========= 계정 저장/조회 (localStorage) ========= */
    const LS_USERS = 'ae_users_v1';

    function loadUsers(){
      try{
        const raw = localStorage.getItem(LS_USERS);
        const obj = raw ? JSON.parse(raw) : {};
        return (obj && typeof obj==='object') ? obj : {};
      }catch(e){
        console.warn('[users] load fail', e);
        return {};
      }
    }
    function saveUsers(users){
      try{
        localStorage.setItem(LS_USERS, JSON.stringify(users));
      }catch(e){
        console.warn('[users] save fail', e);
      }
    }

    function normalizeId(id){ return (id||'').trim(); }

    async function sha256(text){
      if(window.crypto && window.crypto.subtle){
        const enc = new TextEncoder().encode(text);
        const buf = await crypto.subtle.digest('SHA-256', enc);
        return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
      }else{
        // Fallback(보안 약함)
        return 'plain:' + text;
      }
    }

    /* ========= Sign Up ========= */
    (function(){
      const form = document.getElementById('signup_form');
      if(!form) return;

      form.addEventListener('submit', async function(e){
        e.preventDefault();
        const fname = normalizeId(document.getElementById('fname').value);
        const lname = normalizeId(document.getElementById('lname').value);
        const email = normalizeId(document.getElementById('email_signup').value);
        const pass  = document.getElementById('signup_password').value || '';
        const cpass = document.getElementById('cpass').value || '';
        const msg   = document.getElementById('signup-msg');

        if(!email || !pass || !cpass){
          msg.textContent = '모든 필드를 입력해주세요.'; msg.style.display='block'; return;
        }
        if(pass.length < 4){
          msg.textContent = '비밀번호는 4자 이상으로 설정해주세요.'; msg.style.display='block'; return;
        }
        if(pass !== cpass){
          msg.textContent = '비밀번호가 일치하지 않습니다.'; msg.style.display='block'; return;
        }

        const users = loadUsers();
        if(users[email]){
          msg.textContent = '이미 존재하는 아이디입니다.'; msg.style.display='block'; return;
        }

        const passwordHash = await sha256(pass);
        users[email] = { email, passwordHash, fname, lname, role:'viewer', createdAt: Date.now() };
        saveUsers(users);

        localStorage.setItem('ae_role','viewer');
        localStorage.setItem('ae_user', email);

        msg.classList.remove('msg-error');
        msg.classList.add('msg-ok');
        msg.textContent = '계정이 생성되었습니다. 이동 중...';
        msg.style.display='block';

        window.location.href = 'cctv.html';
      });
    })();

    /* ========= Sign In ========= */
    (function(){
      const loginForm = document.getElementById('login_form');
      if(!loginForm) return;

      loginForm.addEventListener('submit', async function(e){
        e.preventDefault();
        const id = normalizeId(document.getElementById('email').value);
        const pw = document.getElementById('login_password').value || '';
        const err = document.getElementById('login-error');

        if(!id || !pw){
          err.textContent = '아이디와 비밀번호를 입력하세요.'; err.style.display='block'; return;
        }

        if(id === 'admin' && pw === 'admin'){
          localStorage.setItem('ae_role','admin');
          localStorage.setItem('ae_user', id);
          err.style.display = 'none';
          window.location.href = 'cctv.html';
          return;
        }

        const users = loadUsers();
        const u = users[id];
        if(!u){
          err.textContent = '존재하지 않는 아이디입니다.'; err.style.display='block'; return;
        }
        const hash = await sha256(pw);
        if(hash !== u.passwordHash){
          err.textContent = '비밀번호가 올바르지 않습니다.'; err.style.display='block'; return;
        }

        localStorage.setItem('ae_role', u.role || 'viewer');
        localStorage.setItem('ae_user', u.email);
        err.style.display = 'none';
        window.location.href = 'cctv.html';
      });
    })();
  </script>
</body>
</html>
